-- DB update 2020_05_07_02 -> 2020_05_07_03
DROP PROCEDURE IF EXISTS `updateDb`;
DELIMITER //
CREATE PROCEDURE updateDb ()
proc:BEGIN DECLARE OK VARCHAR(100) DEFAULT 'FALSE';
SELECT COUNT(*) INTO @COLEXISTS
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'version_db_sol_world' AND COLUMN_NAME = '2020_05_07_02';
IF @COLEXISTS = 0 THEN LEAVE proc; END IF;
START TRANSACTION;
ALTER TABLE version_db_sol_world CHANGE COLUMN 2020_05_07_02 2020_05_07_03 bit;
SELECT sql_rev INTO OK FROM version_db_sol_world WHERE sql_rev = '1588885064856692242'; IF OK <> 'FALSE' THEN LEAVE proc; END IF;
--
-- START UPDATING QUERIES
--

INSERT INTO `version_db_sol_world` (`sql_rev`) VALUES ('1588885064856692242');

-- Cleanup unused waypoint paths
UPDATE `creature` SET `MovementType` = 0 WHERE `guid` IN (57595,57596,57597);
UPDATE `creature_addon` SET `path_id` = 0 WHERE `guid` IN (57595,57596,57597);
DELETE FROM `waypoint_data` WHERE `id` IN (575950,575960,575970);

-- Update position of the wolf riders
UPDATE `creature` SET `position_x` = 196.28, `position_y` = 2781.24, `position_z` = 115.964, `orientation` = 0.396799 WHERE `guid` = 57596;
UPDATE `creature` SET `position_x` = 192.549, `position_y` = 2779.3, `position_z` = 114.719, `orientation` = 0.396799 WHERE `guid` = 57595;
UPDATE `creature` SET `position_x` = 186.688, `position_y` = 2777.33, `position_z` = 113.304, `orientation` = 0.396799 WHERE `guid` = 57594;
UPDATE `creature` SET `position_x` = 180.347, `position_y` = 2775.74, `position_z` = 111.863, `orientation` = 0.396799 WHERE `guid` = 57597;

-- Update formation
DELETE FROM `creature_formations` WHERE `leaderGUID` = 57594;
INSERT INTO `creature_formations` (`leaderGUID`, `memberGUID`, `dist`, `angle`, `groupAI`)
VALUES
(57594,57594,0,0,2),
(57594,57595,5,0,2),
(57594,57596,10,0,2),
(57594,57597,5,180,2);

-- Rework the path
DELETE FROM `waypoint_data` WHERE `id` = 575940;
INSERT INTO `waypoint_data` (`id`, `point`, `position_x`, `position_y`, `position_z`, `orientation`, `delay`, `move_type`, `action`, `action_chance`, `wpguid`)
VALUES
(575940,1,182.597,2773.71,112.055,0,0,1,0,100,0),
(575940,2,190.841,2772.92,113.863,0,0,1,0,100,0),
(575940,3,200.417,2774.74,116.508,0,0,1,0,100,0),
(575940,4,206.16,2778.61,117.824,0,0,1,0,100,0),
(575940,5,208.004,2784.58,118.056,0,0,1,0,100,0),
(575940,6,206.266,2791.36,118.587,0,0,1,0,100,0),
(575940,7,200.999,2795.73,118.765,0,0,1,0,100,0),
(575940,8,192.797,2796.49,118.363,0,0,1,0,100,0),
(575940,9,186.151,2792.58,116.878,0,0,1,0,100,0),
(575940,10,182.16,2786.65,115.181,0,0,1,0,100,0),
(575940,11,178.663,2780.26,112.598,0,0,1,0,100,0),
(575940,12,173.701,2773.86,111.062,0,0,1,0,100,0),
(575940,13,144.201,2764.99,105.126,0,0,1,0,100,0),
(575940,14,113.74,2748.57,96.213,0,0,1,0,100,0),
(575940,15,94.4127,2728.12,89.8125,0,0,1,0,100,0),
(575940,16,65.7711,2693.39,82.3819,0,0,1,0,100,0),
(575940,17,36.7646,2661.93,76.7891,0,0,1,0,100,0),
(575940,18,17.919,2638.4,72.612,0,0,1,0,100,0),
(575940,19,5.35553,2605.85,68.4775,0,0,1,0,100,0),
(575940,20,8.97837,2575.03,65.2146,0,0,1,0,100,0),
(575940,21,18.0501,2542.31,61.6518,0,0,1,0,100,0),
(575940,22,20.6387,2501,57.128,0,0,1,0,100,0),
(575940,23,14.1433,2460.92,53.1017,0,0,1,0,100,0),
(575940,24,7.45386,2419.16,52.7354,0,0,1,0,100,0),
(575940,25,-14.2587,2395.82,52.6949,0,0,1,0,100,0),
(575940,26,-17.2148,2385.94,53.4052,0,0,1,0,100,0),
(575940,27,-20.4427,2380.65,54.038,0,0,1,0,100,0),
(575940,28,-26.325,2375.52,54.6354,0,0,1,0,100,0),
(575940,29,-32.5603,2374.63,54.5032,0,0,1,0,100,0),
(575940,30,-38.7119,2378.27,53.8912,0,0,1,0,100,0),
(575940,31,-40.9813,2383.05,53.6177,0,0,1,0,100,0),
(575940,32,-39.3886,2389.95,53.3125,0,0,1,0,100,0),
(575940,33,-33.1163,2394.63,53.2404,0,0,1,0,100,0),
(575940,34,-25.5003,2398.42,52.7846,0,0,1,0,100,0),
(575940,35,-15.0033,2403.5,52.118,0,0,1,0,100,0),
(575940,36,0.0562611,2409.99,52.1987,0,0,1,0,100,0),
(575940,37,13.3088,2456.08,52.3432,0,0,1,0,100,0),
(575940,38,20.0041,2493,56.1838,0,0,1,0,100,0),
(575940,39,19.1884,2536.79,60.8199,0,0,1,0,100,0),
(575940,40,11.0524,2567.62,64.1568,0,0,1,0,100,0),
(575940,41,4.75031,2601.44,67.7873,0,0,1,0,100,0),
(575940,42,13.328,2630.8,71.1636,0,0,1,0,100,0),
(575940,43,32.4079,2656.75,75.6566,0,0,1,0,100,0),
(575940,44,62.5213,2689.98,81.5397,0,0,1,0,100,0),
(575940,45,92.9825,2726.69,89.3199,0,0,1,0,100,0),
(575940,46,109.418,2745,94.7664,0,0,1,0,100,0),
(575940,47,142.042,2764.24,104.199,0,0,1,0,100,0),
(575940,48,171.169,2772.71,110.299,0,0,1,0,100,0);

--
-- END UPDATING QUERIES
--
COMMIT;
END //
DELIMITER ;
CALL updateDb();
DROP PROCEDURE IF EXISTS `updateDb`;
