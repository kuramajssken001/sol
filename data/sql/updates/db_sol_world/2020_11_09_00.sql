-- DB update 2020_11_04_01 -> 2020_11_09_00
DROP PROCEDURE IF EXISTS `updateDb`;
DELIMITER //
CREATE PROCEDURE updateDb ()
proc:BEGIN DECLARE OK VARCHAR(100) DEFAULT 'FALSE';
SELECT COUNT(*) INTO @COLEXISTS
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'version_db_sol_world' AND COLUMN_NAME = '2020_11_04_01';
IF @COLEXISTS = 0 THEN LEAVE proc; END IF;
START TRANSACTION;
ALTER TABLE version_db_sol_world CHANGE COLUMN 2020_11_04_01 2020_11_09_00 bit;
SELECT sql_rev INTO OK FROM version_db_sol_world WHERE sql_rev = '1604928064247760805'; IF OK <> 'FALSE' THEN LEAVE proc; END IF;
--
-- START UPDATING QUERIES
--

INSERT INTO `version_db_sol_world` (`sql_rev`) VALUES ('1604928064247760805');

-- Enable random movement for a few critters in ICC
UPDATE `creature` SET `wander_distance` = 5, `MovementType` = 1 WHERE `id` IN (14881,4076,2110) AND `map` = 631;

-- Disable "Stoneform" aura, will be handled via SAI
UPDATE `creature_template_addon` SET `auras` = '' WHERE `entry` IN (37007,38031);

DELETE FROM `smart_scripts` WHERE `entryorguid` IN (-200987,-201043,-201108,-201130) AND `source_type` = 0;
INSERT INTO `smart_scripts` (`entryorguid`, `source_type`, `id`, `link`, `event_type`, `event_phase_mask`, `event_chance`, `event_flags`, `event_param1`, `event_param2`, `event_param3`, `event_param4`, `event_param5`, `action_type`, `action_param1`, `action_param2`, `action_param3`, `action_param4`, `action_param5`, `action_param6`, `target_type`, `target_param1`, `target_param2`, `target_param3`, `target_param4`, `target_x`, `target_y`, `target_z`, `target_o`, `comment`)
VALUES
(-200987,0,0,0,11,0,100,0,0,0,0,0,0,75,70733,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Deathbound Ward - On Respawn - Add Aura ''Stoneform'''),
(-200987,0,1,0,0,0,100,0,3000,6000,6000,8000,0,11,71021,2,0,0,0,0,2,0,0,0,0,0,0,0,0,'Deathbound Ward - In Combat - Cast ''Saber Lash'''),
(-200987,0,2,0,0,0,100,0,6000,8000,6000,12000,0,11,71022,0,0,0,0,0,2,0,0,0,0,0,0,0,0,'Deathbound Ward - In Combat - Cast ''Disrupting Shout'''),
(-200987,0,3,0,38,0,100,0,1,1,0,0,0,53,0,3700700,1,0,0,2,1,0,0,0,0,0,0,0,0,'Deathbound Ward - On Data Set 1 1 - Start Waypoint Movement'),

(-201043,0,0,0,11,0,100,0,0,0,0,0,0,75,70733,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Deathbound Ward - On Respawn - Add Aura ''Stoneform'''),
(-201043,0,1,0,0,0,100,0,3000,6000,6000,8000,0,11,71021,2,0,0,0,0,2,0,0,0,0,0,0,0,0,'Deathbound Ward - In Combat - Cast ''Saber Lash'''),
(-201043,0,2,0,0,0,100,0,6000,8000,6000,12000,0,11,71022,0,0,0,0,0,2,0,0,0,0,0,0,0,0,'Deathbound Ward - In Combat - Cast ''Disrupting Shout'''),
(-201043,0,3,0,38,0,100,0,1,1,0,0,0,53,0,3700701,1,0,0,2,1,0,0,0,0,0,0,0,0,'Deathbound Ward - On Data Set 1 1 - Start Waypoint Movement'),

(-201108,0,0,0,11,0,100,0,0,0,0,0,0,75,70733,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Deathbound Ward - On Respawn - Add Aura ''Stoneform'''),
(-201108,0,1,0,0,0,100,0,3000,6000,6000,8000,0,11,71021,2,0,0,0,0,2,0,0,0,0,0,0,0,0,'Deathbound Ward - In Combat - Cast ''Saber Lash'''),
(-201108,0,2,0,0,0,100,0,6000,8000,6000,12000,0,11,71022,0,0,0,0,0,2,0,0,0,0,0,0,0,0,'Deathbound Ward - In Combat - Cast ''Disrupting Shout'''),
(-201108,0,3,0,38,0,100,0,1,1,0,0,0,53,0,3700702,1,0,0,2,1,0,0,0,0,0,0,0,0,'Deathbound Ward - On Data Set 1 1 - Start Waypoint Movement'),

(-201130,0,0,0,11,0,100,0,0,0,0,0,0,75,70733,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Deathbound Ward - On Respawn - Add Aura ''Stoneform'''),
(-201130,0,1,0,0,0,100,0,3000,6000,6000,8000,0,11,71021,2,0,0,0,0,2,0,0,0,0,0,0,0,0,'Deathbound Ward - In Combat - Cast ''Saber Lash'''),
(-201130,0,2,0,0,0,100,0,6000,8000,6000,12000,0,11,71022,0,0,0,0,0,2,0,0,0,0,0,0,0,0,'Deathbound Ward - In Combat - Cast ''Disrupting Shout'''),
(-201130,0,3,0,38,0,100,0,1,1,0,0,0,53,0,3700703,1,0,0,2,1,0,0,0,0,0,0,0,0,'Deathbound Ward - On Data Set 1 1 - Start Waypoint Movement');

DELETE FROM `waypoints` WHERE `entry` IN (3700700,3700701,3700702,3700703);
INSERT INTO `waypoints` (`entry`, `pointid`, `position_x`, `position_y`, `position_z`, `point_comment`)
VALUES
(3700700,1,-194.583,2159.04,37.9852,NULL),
(3700700,2,-184.528,2168.1,37.9852,NULL),
(3700700,3,-172.52,2178.91,37.9852,NULL),
(3700700,4,-172.629,2187.47,35.2626,NULL),
(3700700,5,-172.883,2207.45,35.2336,NULL),
(3700700,6,-173.179,2230.67,35.3043,NULL),
(3700700,7,-173.25,2236.28,36.0156,NULL),
(3700700,8,-173.356,2244.59,37.9851,NULL),
(3700700,9,-182.652,2252.4,37.9851,NULL),
(3700700,10,-191.483,2259.81,37.9851,NULL),
(3700700,11,-204.857,2253.83,37.9851,NULL),
(3700700,12,-217.857,2248.03,37.9851,NULL),
(3700700,13,-233.296,2241.13,37.9851,NULL),
(3700700,14,-236.627,2234.45,37.9851,NULL),
(3700700,15,-239.475,2228.74,40.5114,NULL),
(3700700,16,-242.451,2222.78,42.5646,NULL),
(3700700,17,-242.524,2212.4,42.5646,NULL),
(3700700,18,-242.6,2201.63,42.5646,NULL),
(3700700,19,-239.298,2195.07,40.7183,NULL),
(3700700,20,-236.095,2188.71,37.9852,NULL),
(3700700,21,-233.272,2183.1,37.9851,NULL),
(3700700,22,-223.369,2176.94,37.9851,NULL),
(3700700,23,-208.015,2167.39,37.9851,NULL),

(3700701,1,-191.483,2259.81,37.9851,NULL),
(3700701,2,-212.254,2250.53,37.9851,NULL),
(3700701,3,-233.296,2241.13,37.9851,NULL),
(3700701,4,-236.618,2234.47,37.9852,NULL),
(3700701,5,-239.531,2228.63,40.5549,NULL),
(3700701,6,-242.451,2222.78,42.5646,NULL),
(3700701,7,-242.6,2201.63,42.5646,NULL),
(3700701,8,-239.188,2194.85,40.6329,NULL),
(3700701,9,-236.176,2188.87,37.9851,NULL),
(3700701,10,-233.272,2183.1,37.9851,NULL),
(3700701,11,-224.159,2177.43,37.9851,NULL),
(3700701,12,-209.406,2168.26,37.9851,NULL),
(3700701,13,-194.583,2159.04,37.9852,NULL),
(3700701,14,-182.968,2169.5,37.9852,NULL),
(3700701,15,-172.52,2178.91,37.9852,NULL),
(3700701,16,-172.575,2183.22,36.981,NULL),
(3700701,17,-172.623,2186.99,35.2347,NULL),
(3700701,18,-172.771,2198.6,35.2335,NULL),
(3700701,19,-172.962,2213.65,35.2335,NULL),
(3700701,20,-173.179,2230.68,35.306,NULL),
(3700701,21,-173.261,2237.14,35.9662,NULL),
(3700701,22,-173.356,2244.59,37.9851,NULL),
(3700701,23,-182.829,2252.54,37.9851,NULL),

(3700702,1,-276.016,2211.87,42.5645,NULL),
(3700702,2,-261.436,2211.72,42.5645,NULL),
(3700702,3,-239.08,2211.49,42.5645,NULL),
(3700702,4,-231.849,2211.53,40.6957,NULL),
(3700702,5,-222.63,2211.58,37.7468,NULL),
(3700702,6,-213.092,2211.63,35.2335,NULL),
(3700702,7,-222.63,2211.58,37.7468,NULL),
(3700702,8,-231.849,2211.53,40.6957,NULL),
(3700702,9,-239.08,2211.49,42.5645,NULL),
(3700702,10,-261.436,2211.72,42.5645,NULL),
(3700702,11,-273.224,2211.71,42.5645,NULL),
(3700702,12,-288.855,2211.69,42.5645,NULL),
(3700702,13,-293.524,2211.68,42.0147,NULL),
(3700702,14,-309.028,2211.66,42.0142,NULL),
(3700702,15,-312.059,2211.66,42.5649,NULL),
(3700702,16,-330.952,2211.63,42.5649,NULL),
(3700702,17,-350.122,2211.61,42.4406,NULL),
(3700702,18,-330.952,2211.63,42.5649,NULL),
(3700702,19,-312.059,2211.66,42.5649,NULL),
(3700702,20,-309.028,2211.66,42.0142,NULL),
(3700702,21,-293.524,2211.68,42.0147,NULL),
(3700702,22,-288.855,2211.69,42.5645,NULL),

(3700703,1,-301.121,2212.05,42.0128,NULL),
(3700703,2,-309.184,2211.98,42.0128,NULL),
(3700703,3,-311.641,2211.96,42.5645,NULL),
(3700703,4,-329.714,2211.79,42.5645,NULL),
(3700703,5,-350.122,2211.61,42.4406,NULL),
(3700703,6,-329.714,2211.79,42.5645,NULL),
(3700703,7,-311.641,2211.96,42.5645,NULL),
(3700703,8,-309.184,2211.98,42.0128,NULL),
(3700703,9,-291.447,2211.77,42.0128,NULL),
(3700703,10,-288.297,2211.73,42.565,NULL),
(3700703,11,-268.461,2211.5,42.565,NULL),
(3700703,12,-245.857,2211.23,42.5645,NULL),
(3700703,13,-268.461,2211.5,42.565,NULL),
(3700703,14,-288.297,2211.73,42.565,NULL),
(3700703,15,-291.447,2211.77,42.0128,NULL);

--
-- END UPDATING QUERIES
--
COMMIT;
END //
DELIMITER ;
CALL updateDb();
DROP PROCEDURE IF EXISTS `updateDb`;
