-- DB update 2021_08_27_00 -> 2021_08_27_01
DROP PROCEDURE IF EXISTS `updateDb`;
DELIMITER //
CREATE PROCEDURE updateDb ()
proc:BEGIN DECLARE OK VARCHAR(100) DEFAULT 'FALSE';
SELECT COUNT(*) INTO @COLEXISTS
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'version_db_sol_world' AND COLUMN_NAME = '2021_08_27_00';
IF @COLEXISTS = 0 THEN LEAVE proc; END IF;
START TRANSACTION;
ALTER TABLE version_db_sol_world CHANGE COLUMN 2021_08_27_00 2021_08_27_01 bit;
SELECT sql_rev INTO OK FROM version_db_sol_world WHERE sql_rev = '1630101330924980519'; IF OK <> 'FALSE' THEN LEAVE proc; END IF;
--
-- START UPDATING QUERIES
--

INSERT INTO `version_db_sol_world` (`sql_rev`) VALUES ('1630101330924980519');

-- Quel'dorei Magewraith: Remove all spawn points as the creature is summoned via SAI
DELETE FROM `creature` WHERE `id` = 17612;

-- Quel'dorei Magewraith: Initial friendly, changed later via SAI
UPDATE `creature_template` SET `faction` = 35 WHERE `entry` = 17612;

UPDATE `creature_template` SET `AIName` = 'SmartAI' WHERE `entry` IN (17475,17190);
DELETE FROM `smart_scripts` WHERE `source_type` = 0 AND `entryorguid` IN (17475,17190,17191,17192,17612);
DELETE FROM `smart_scripts` WHERE `source_type` = 9 AND `entryorguid` = 1761200;
INSERT INTO `smart_scripts` (`entryorguid`, `source_type`, `id`, `link`, `event_type`, `event_phase_mask`, `event_chance`, `event_flags`, `event_param1`, `event_param2`, `event_param3`, `event_param4`, `event_param5`, `action_type`, `action_param1`, `action_param2`, `action_param3`, `action_param4`, `action_param5`, `action_param6`, `target_type`, `target_param1`, `target_param2`, `target_param3`, `target_param4`, `target_x`, `target_y`, `target_z`, `target_o`, `comment`)
VALUES
(17475,0,0,0,6,0,20,0,0,0,0,0,0,12,17612,4,120000,0,0,0,1,0,0,0,0,0,0,0,0,'Murgurgula - On Death - Summon Creature ''Quel''dorei Magewraith'''),
(17475,0,1,0,11,0,100,0,0,0,0,0,0,48,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Murgurgula - On Respawn - Set Active On'),

(17190,0,0,0,6,0,20,0,0,0,0,0,0,12,17612,4,120000,0,0,0,1,0,0,0,0,0,0,0,0,'Siltfin Murloc - On Death - Summon Creature ''Quel''dorei Magewraith'''),

(17191,0,0,0,6,0,20,0,0,0,0,0,0,12,17612,4,120000,0,0,0,1,0,0,0,0,0,0,0,0,'Siltfin Oracle - On Death - Summon Creature ''Quel''dorei Magewraith'''),
(17191,0,1,0,0,0,100,0,0,0,2000,2000,0,11,12550,32,0,0,0,0,1,0,0,0,0,0,0,0,0,'Siltfin Oracle - IC - Cast ''Lightning Shield'''),
(17191,0,2,0,0,0,100,0,0,0,2100,2200,0,11,9739,64,0,0,0,0,2,0,0,0,0,0,0,0,0,'Siltfin Oracle - IC CMC - Cast ''Wrath'''),
(17191,0,3,0,2,0,100,1,0,15,0,0,0,25,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Siltfin Oracle - Between 0-15% Health - Flee For Assist (No Repeat)'),

(17192,0,0,0,6,0,20,0,0,0,0,0,0,12,17612,4,120000,0,0,0,1,0,0,0,0,0,0,0,0,'Siltfin Hunter - On Death - Summon Creature ''Quel''dorei Magewraith'''),
(17192,0,1,0,0,0,100,0,5,30,2000,3000,1,11,10277,64,0,0,0,0,2,0,0,0,0,0,0,0,0,'Siltfin Hunter - Within 5-30 Range - Cast ''Throw'''),
(17192,0,2,0,2,0,100,1,0,15,0,0,0,25,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'Siltfin Hunter - Between 0-15% Health - Flee For Assist (No Repeat)'),

(17612,0,0,0,0,0,100,0,0,0,3100,3200,0,11,11921,64,0,0,0,0,2,0,0,0,0,0,0,0,0,'Quel''dorei Magewraith - IC CMC - Cast ''Fireball'''),
(17612,0,1,0,0,0,100,0,7000,11000,9000,13000,0,11,31595,64,0,0,0,0,2,0,0,0,0,0,0,0,0,'Quel''dorei Magewraith - IC CMC - Cast ''Arcane Bolt'''),
(17612,0,2,0,0,0,100,0,9000,13000,7000,11000,0,11,31604,64,0,0,0,0,2,0,0,0,0,0,0,0,0,'Quel''dorei Magewraith - IC CMC - Cast ''Arcane Weakness'''),
(17612,0,3,0,0,0,100,0,11000,15000,16000,20000,0,11,11436,64,0,0,0,0,2,0,0,0,0,0,0,0,0,'Quel''dorei Magewraith - IC CMC - Cast ''Slow'''),
(17612,0,4,0,13,0,100,0,10000,15000,0,0,0,11,31596,65,0,0,0,0,7,0,0,0,0,0,0,0,0,'Quel''dorei Magewraith - On Target Casting - Cast ''Counterspell'''),
(17612,0,5,0,6,0,100,0,0,0,0,0,0,15,9595,0,0,0,0,0,16,0,0,0,0,0,0,0,0,'Quel''dorei Magewraith - On Death - Quest Credit ''Control'''),
(17612,0,6,0,54,0,100,0,0,0,0,0,0,80,1761200,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Quel''dorei Magewraith - On Just Summoned - Call Timed Action List'),

(1761200,9,0,0,0,0,100,0,0,0,0,0,0,47,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Quel''dorei Magewraith - On Script - Set Visibility Off'),
(1761200,9,1,0,0,0,100,0,0,0,0,0,0,48,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Quel''dorei Magewraith - On Script - Set Active On'),
(1761200,9,2,0,0,0,100,0,0,0,0,0,0,89,10,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Quel''dorei Magewraith - On Script - Enable Random Movement'),
(1761200,9,3,0,0,0,100,0,10000,15000,0,0,0,47,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Infernal Invader - On Script - Set Visibility On'),
(1761200,9,4,0,0,0,100,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Quel''dorei Magewraith - On Script - Say Line 0'),
(1761200,9,5,0,0,0,100,0,0,0,0,0,0,2,91,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Infernal Invader - On Script - Set Faction 91'),
(1761200,9,6,0,0,0,100,0,0,0,0,0,0,49,0,0,0,0,0,0,21,50,0,0,0,0,0,0,0,'Quel''dorei Magewraith - On Script - Attack Closest Player');

DELETE FROM `conditions` WHERE `SourceTypeOrReferenceId` = 22 AND `ConditionTypeOrReference` IN (29,47) AND `SourceEntry` IN (17475,17190,17191,17192);
INSERT INTO `conditions` (`SourceTypeOrReferenceId`, `SourceGroup`, `SourceEntry`, `SourceId`, `ElseGroup`, `ConditionTypeOrReference`, `ConditionTarget`, `ConditionValue1`, `ConditionValue2`, `ConditionValue3`, `NegativeCondition`, `ErrorType`, `ErrorTextId`, `Comment`)
VALUES
(22,1,17475,0,0,29,0,17612,100,0,1,0,0,'Murgurgula - Execute SAI only if not near ''Quel''dorei Magewraith'''),
(22,1,17475,0,0,47,0,9595,8,0,0,0,0,'Murgurgula - Execute SAI only if quest ''Control'' is in progress'),

(22,1,17190,0,0,29,0,17612,100,0,1,0,0,'Siltfin Murloc - Execute SAI only if not near ''Quel''dorei Magewraith'''),
(22,1,17190,0,0,47,0,9595,8,0,0,0,0,'Siltfin Murloc - Execute SAI only if quest ''Control'' is in progress'),

(22,1,17191,0,0,29,0,17612,100,0,1,0,0,'Siltfin Oracle - Execute SAI only if not near ''Quel''dorei Magewraith'''),
(22,1,17191,0,0,47,0,9595,8,0,0,0,0,'Siltfin Oracle - Execute SAI only if quest ''Control'' is in progress'),

(22,1,17192,0,0,29,0,17612,100,0,1,0,0,'Siltfin Hunter - Execute SAI only if not near ''Quel''dorei Magewraith'''),
(22,1,17192,0,0,47,0,9595,8,0,0,0,0,'Siltfin Hunter - Execute SAI only if quest ''Control'' is in progress');

-- Murgurgula: Enable WP movement
UPDATE `creature` SET `MovementType` = 2 WHERE `guid` = 62989;
UPDATE `creature_addon` SET `path_id` = 629890 WHERE `guid` = 62989;

DELETE FROM `waypoint_data` WHERE `id` = 629890;
INSERT INTO `waypoint_data` (`id`, `point`, `position_x`, `position_y`, `position_z`, `orientation`, `delay`, `move_type`, `action`, `action_chance`, `wpguid`)
VALUES
(629890,1,-3390.28,-11925,3.94614,0,0,0,0,100,0),
(629890,2,-3378.02,-11918.5,3.35502,0,0,0,0,100,0),
(629890,3,-3373.88,-11912.1,3.25508,0,0,0,0,100,0),
(629890,4,-3371.34,-11908.2,2.96948,0,0,0,0,100,0),
(629890,5,-3364.69,-11897.9,1.94512,0,0,0,0,100,0),
(629890,6,-3358.06,-11892.5,1.62097,0,0,0,0,100,0),
(629890,7,-3352.22,-11887.8,0.884004,0,0,0,0,100,0),
(629890,8,-3344.98,-11885.1,0.989547,0,0,0,0,100,0),
(629890,9,-3338.67,-11882.7,1.38813,0,0,0,0,100,0),
(629890,10,-3327.35,-11882.9,1.08504,0,0,0,0,100,0),
(629890,11,-3315.99,-11883,1.20321,0,0,0,0,100,0),
(629890,12,-3311.01,-11883.1,1.40036,0,0,0,0,100,0),
(629890,13,-3305.63,-11883.2,1.41506,0,0,0,0,100,0),
(629890,14,-3298.41,-11883.6,1.26025,0,0,0,0,100,0),
(629890,15,-3289.21,-11884.2,1.05472,0,0,0,0,100,0),
(629890,16,-3275.48,-11885.1,1.29597,0,0,0,0,100,0),
(629890,17,-3263.73,-11885.8,1.17472,0,0,0,0,100,0),
(629890,18,-3254.17,-11886.3,1.14878,0,0,0,0,100,0),
(629890,19,-3239.72,-11887,0.773717,0,0,0,0,100,0),
(629890,20,-3227.95,-11887.6,1.12963,0,0,0,0,100,0),
(629890,21,-3217.82,-11888.1,1.40486,0,0,0,0,100,0),
(629890,22,-3211.79,-11889.9,1.72977,0,0,0,0,100,0),
(629890,23,-3203.64,-11892.4,1.57969,0,0,0,0,100,0),
(629890,24,-3195.39,-11894.9,1.35863,0,0,0,0,100,0),
(629890,25,-3189.26,-11896.8,1.29253,0,0,0,0,100,0),
(629890,26,-3181.94,-11899.5,1.2549,0,0,0,0,100,0),
(629890,27,-3171.45,-11903.5,1.65383,0,0,0,0,100,0),
(629890,28,-3162.28,-11906.9,1.76674,0,0,0,0,100,0),
(629890,29,-3155.32,-11909.5,1.94541,0,0,0,0,100,0),
(629890,30,-3149.17,-11912.6,1.99531,0,0,0,0,100,0),
(629890,31,-3142.4,-11916,1.81432,0,0,0,0,100,0),
(629890,32,-3136.6,-11918.9,1.80227,0,0,0,0,100,0),
(629890,33,-3132.45,-11923,2.09957,0,0,0,0,100,0),
(629890,34,-3127.88,-11927.5,2.24992,0,0,0,0,100,0),
(629890,35,-3124,-11931.3,1.80152,0,0,0,0,100,0),
(629890,36,-3119.34,-11935.9,1.81851,0,0,0,0,100,0),
(629890,37,-3116.09,-11939.1,1.79153,0,10000,0,0,100,0),
(629890,38,-3118.53,-11936.7,1.82048,0,0,0,0,100,0),
(629890,39,-3124.43,-11930.9,1.86427,0,0,0,0,100,0),
(629890,40,-3127.42,-11927.9,2.22522,0,0,0,0,100,0),
(629890,41,-3133.01,-11922.4,2.06622,0,0,0,0,100,0),
(629890,42,-3135.78,-11919.7,1.86409,0,0,0,0,100,0),
(629890,43,-3141.46,-11917,1.79892,0,0,0,0,100,0),
(629890,44,-3147.46,-11914.1,2.01409,0,0,0,0,100,0),
(629890,45,-3153.99,-11911,1.99733,0,0,0,0,100,0),
(629890,46,-3160.09,-11908.1,1.88724,0,0,0,0,100,0),
(629890,47,-3168.4,-11904.1,1.61006,0,0,0,0,100,0),
(629890,48,-3175.88,-11900.5,1.37822,0,0,0,0,100,0),
(629890,49,-3180.95,-11899.2,1.21491,0,0,0,0,100,0),
(629890,50,-3187.72,-11897.4,1.2341,0,0,0,0,100,0),
(629890,51,-3193.7,-11895.8,1.32862,0,0,0,0,100,0),
(629890,52,-3200.79,-11893.9,1.53178,0,0,0,0,100,0),
(629890,53,-3208.46,-11891.8,1.85456,0,0,0,0,100,0),
(629890,54,-3214.3,-11890.3,1.77708,0,0,0,0,100,0),
(629890,55,-3219.13,-11889,1.46368,0,0,0,0,100,0),
(629890,56,-3226.32,-11888.3,1.14821,0,0,0,0,100,0),
(629890,57,-3232.94,-11887.7,1.13238,0,0,0,0,100,0),
(629890,58,-3239.45,-11887.1,0.781074,0,0,0,0,100,0),
(629890,59,-3247.34,-11886.3,0.87759,0,0,0,0,100,0),
(629890,60,-3255.03,-11885.9,1.1234,0,0,0,0,100,0),
(629890,61,-3264.7,-11885.4,1.15493,0,0,0,0,100,0),
(629890,62,-3274.48,-11884.9,1.2672,0,0,0,0,100,0),
(629890,63,-3280.18,-11884.6,1.25176,0,0,0,0,100,0),
(629890,64,-3284.99,-11884.3,1.18204,0,0,0,0,100,0),
(629890,65,-3292.44,-11883.8,0.973016,0,0,0,0,100,0),
(629890,66,-3300.23,-11883.2,1.2901,0,0,0,0,100,0),
(629890,67,-3308.5,-11882.6,1.43783,0,0,0,0,100,0),
(629890,68,-3313.86,-11882.3,1.25578,0,0,0,0,100,0),
(629890,69,-3319.21,-11881.9,1.07197,0,0,0,0,100,0),
(629890,70,-3323.19,-11881.6,1.0721,0,0,0,0,100,0),
(629890,71,-3329.52,-11882.6,1.09111,0,0,0,0,100,0),
(629890,72,-3337.47,-11883.9,1.55419,0,0,0,0,100,0),
(629890,73,-3341.64,-11884.6,1.31528,0,0,0,0,100,0),
(629890,74,-3347.47,-11887.6,0.948943,0,0,0,0,100,0),
(629890,75,-3354.18,-11891,1.41586,0,0,0,0,100,0),
(629890,76,-3358.96,-11893.4,1.63251,0,0,0,0,100,0),
(629890,77,-3362.57,-11895.2,1.58993,0,0,0,0,100,0),
(629890,78,-3365.48,-11898.9,1.96747,0,0,0,0,100,0),
(629890,79,-3368.7,-11903.1,2.06239,0,0,0,0,100,0),
(629890,80,-3371.74,-11907,2.66572,0,0,0,0,100,0),
(629890,81,-3374.9,-11912.5,3.09868,0,0,0,0,100,0),
(629890,82,-3378.06,-11917.9,3.24772,0,0,0,0,100,0),
(629890,83,-3381.91,-11920.7,3.43579,0,0,0,0,100,0),
(629890,84,-3385.01,-11923,3.56976,0,0,0,0,100,0),
(629890,85,-3396.24,-11924.4,3.92017,0,0,0,0,100,0),
(629890,86,-3401.84,-11925.1,3.55565,0,0,0,0,100,0),
(629890,87,-3408.52,-11922.3,2.55619,0,0,0,0,100,0),
(629890,88,-3415.64,-11919.4,1.91133,0,0,0,0,100,0),
(629890,89,-3423.61,-11916,1.4055,0,0,0,0,100,0),
(629890,90,-3429.68,-11913.5,1.43748,0,0,0,0,100,0),
(629890,91,-3435.23,-11911.2,1.31628,0,0,0,0,100,0),
(629890,92,-3441.17,-11907.5,1.2066,0,0,0,0,100,0),
(629890,93,-3448.2,-11903.1,1.09845,0,0,0,0,100,0),
(629890,94,-3456.72,-11897.8,0.968515,0,0,0,0,100,0),
(629890,95,-3467.63,-11891,0.611871,0,0,0,0,100,0),
(629890,96,-3474.26,-11888.8,0.694119,0,0,0,0,100,0),
(629890,97,-3481.89,-11886.2,0.734195,0,0,0,0,100,0),
(629890,98,-3487.55,-11884.3,0.907164,0,0,0,0,100,0),
(629890,99,-3493.05,-11882.4,1.28996,0,0,0,0,100,0),
(629890,100,-3497.46,-11880.8,1.47452,0,0,0,0,100,0),
(629890,101,-3504.38,-11878.3,1.33013,0,0,0,0,100,0),
(629890,102,-3512.39,-11875.5,1.29932,0,0,0,0,100,0),
(629890,103,-3516.46,-11871.3,1.31899,0,0,0,0,100,0),
(629890,104,-3520.2,-11867.5,1.25214,0,0,0,0,100,0),
(629890,105,-3524.65,-11862.9,1.37204,0,0,0,0,100,0),
(629890,106,-3527.18,-11856.8,1.1675,0,0,0,0,100,0),
(629890,107,-3529.55,-11851,0.80154,0,0,0,0,100,0),
(629890,108,-3528.34,-11844.3,0.287497,0,0,0,0,100,0),
(629890,109,-3527.16,-11837.8,0.298753,0,10000,0,0,100,0),
(629890,110,-3528.33,-11847.2,0.428331,0,0,0,0,100,0),
(629890,111,-3529.07,-11853.1,1.00535,0,0,0,0,100,0),
(629890,112,-3526.36,-11858.5,1.21195,0,0,0,0,100,0),
(629890,113,-3523.63,-11863.9,1.32976,0,0,0,0,100,0),
(629890,114,-3521.42,-11868.3,1.61523,0,0,0,0,100,0),
(629890,115,-3516.11,-11872.3,1.393,0,0,0,0,100,0),
(629890,116,-3510.61,-11876.4,1.23519,0,0,0,0,100,0),
(629890,117,-3507.08,-11879.1,1.48146,0,0,0,0,100,0),
(629890,118,-3501.68,-11880.6,1.62433,0,0,0,0,100,0),
(629890,119,-3495.28,-11882.3,1.49183,0,0,0,0,100,0),
(629890,120,-3489.45,-11884,1.05572,0,0,0,0,100,0),
(629890,121,-3483.16,-11885.7,0.761111,0,0,0,0,100,0),
(629890,122,-3477.28,-11887.3,0.681661,0,0,0,0,100,0),
(629890,123,-3471.69,-11889.9,0.704683,0,0,0,0,100,0),
(629890,124,-3464.42,-11893.4,0.740483,0,0,0,0,100,0),
(629890,125,-3460.58,-11895.2,0.81699,0,0,0,0,100,0),
(629890,126,-3455.11,-11898.6,0.979172,0,0,0,0,100,0),
(629890,127,-3449.54,-11902,1.05315,0,0,0,0,100,0),
(629890,128,-3442.39,-11906.4,1.15847,0,0,0,0,100,0),
(629890,129,-3435.67,-11910.5,1.26091,0,0,0,0,100,0),
(629890,130,-3430.35,-11912.2,1.24534,0,0,0,0,100,0),
(629890,131,-3421.7,-11915.1,1.2026,0,0,0,0,100,0),
(629890,132,-3413.84,-11917.7,1.67015,0,0,0,0,100,0),
(629890,133,-3405.98,-11920.2,2.13317,0,0,0,0,100,0),
(629890,134,-3400.79,-11922,2.94348,0,0,0,0,100,0),
(629890,135,-3395.91,-11923.6,3.71505,0,0,0,0,100,0);

--
-- END UPDATING QUERIES
--
COMMIT;
END //
DELIMITER ;
CALL updateDb();
DROP PROCEDURE IF EXISTS `updateDb`;
