-- DB update 2020_10_01_00 -> 2020_10_01_01
DROP PROCEDURE IF EXISTS `updateDb`;
DELIMITER //
CREATE PROCEDURE updateDb ()
proc:BEGIN DECLARE OK VARCHAR(100) DEFAULT 'FALSE';
SELECT COUNT(*) INTO @COLEXISTS
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'version_db_sol_world' AND COLUMN_NAME = '2020_10_01_00';
IF @COLEXISTS = 0 THEN LEAVE proc; END IF;
START TRANSACTION;
ALTER TABLE version_db_sol_world CHANGE COLUMN 2020_10_01_00 2020_10_01_01 bit;
SELECT sql_rev INTO OK FROM version_db_sol_world WHERE sql_rev = '1601534219725766347'; IF OK <> 'FALSE' THEN LEAVE proc; END IF;
--
-- START UPDATING QUERIES
--

INSERT INTO `version_db_sol_world` (`sql_rev`) VALUES ('1601534219725766347');

-- Brontus SAI: No longer needs to be active as the Wooly Kodo will now lead the creature formation
DELETE FROM `smart_scripts` WHERE `entryorguid` = 5827 AND `source_type` = 0 AND `id` = 2;

-- Take over model IDs from creature template
UPDATE `creature` SET `modelid` = 0 WHERE `guid` IN (15137,15138,15139,15140,51815);

-- Replace one of the Barrens Kodos with Wooly Kodo (new leader of the formation) and adjust the position
UPDATE `creature` SET `id` = 3237, `MovementType` = 2, `position_x` = -2979.44, `position_y` = -2017.6, `position_z` = 92.7704 WHERE `guid` = 15140;

-- Remove WP movement for Brontus and adjust the position (will now just be a member of the formation)
UPDATE `creature` SET `MovementType` = 0, `position_x` = -2989.56, `position_y` = -2018.65, `position_z` = 92.6055 WHERE `guid` = 51815;

-- Replace one of the Barrens Kodos with Greater Barrens Kodo
UPDATE `creature` SET `id` = 3235 WHERE `guid` = 15138;

-- Remove old creature formation (Brontus) and create a new one (Wooly Kodo)
DELETE FROM `creature_formations` WHERE `leaderGUID` IN (51815,15140);
INSERT INTO `creature_formations` (`leaderGUID`, `memberGUID`, `dist`, `angle`, `groupAI`)
VALUES
(15140,15140,0,0,2),
(15140,51815,7,270,2),
(15140,15138,7,90,2),
(15140,15137,12,340,2),
(15140,15139,12,20,2);

-- Remove WP movement for Brontus and specify a new one for the Wooly Kodo
DELETE FROM `creature_addon` WHERE `guid` IN (51815,15140);
INSERT INTO `creature_addon` (`guid`, `path_id`, `mount`, `bytes1`, `bytes2`, `emote`, `isLarge`, `auras`)
VALUES
(15140,151400,0,0,0,0,0,'');

DELETE FROM `waypoint_data` WHERE `id` IN (518150,151400);
INSERT INTO `waypoint_data` (`id`, `point`, `position_x`, `position_y`, `position_z`, `orientation`, `delay`, `move_type`, `action`, `action_chance`, `wpguid`)
VALUES
(151400,1,-2998.13,-2012.47,91.7341,0,0,0,0,100,0),
(151400,2,-3009.01,-2009.7,92.2834,0,0,0,0,100,0),
(151400,3,-3021.41,-2006.53,92.0919,0,0,0,0,100,0),
(151400,4,-3034.42,-2003.22,92.2492,0,0,0,0,100,0),
(151400,5,-3048.43,-1999.64,91.8638,0,0,0,0,100,0),
(151400,6,-3060.75,-1996.5,92.6879,0,0,0,0,100,0),
(151400,7,-3068.35,-1989.06,92.7232,0,0,0,0,100,0),
(151400,8,-3077.07,-1977.09,91.6684,0,0,0,0,100,0),
(151400,9,-3090.27,-1968.93,91.709,0,0,0,0,100,0),
(151400,10,-3104.83,-1967.37,92.1543,0,0,0,0,100,0),
(151400,11,-3120.56,-1966.8,92.443,0,0,0,0,100,0),
(151400,12,-3135.91,-1972.39,93.1792,0,0,0,0,100,0),
(151400,13,-3149.46,-1977.12,93.2822,0,0,0,0,100,0),
(151400,14,-3160.92,-1981.11,92.6523,0,0,0,0,100,0),
(151400,15,-3173.37,-1985.45,91.6485,0,0,0,0,100,0),
(151400,16,-3187.47,-1990.36,92.4655,0,0,0,0,100,0),
(151400,17,-3203.99,-1996.12,94.0706,0,0,0,0,100,0),
(151400,18,-3218.75,-2001.27,93.0192,0,0,0,0,100,0),
(151400,19,-3235.61,-2007.14,92.4948,0,0,0,0,100,0),
(151400,20,-3251.25,-2012.59,91.9919,0,0,0,0,100,0),
(151400,21,-3266.02,-2017.74,92.6474,0,0,0,0,100,0),
(151400,22,-3280.42,-2013.41,93.5319,0,0,0,0,100,0),
(151400,23,-3303.65,-2005.98,93.993,0,0,0,0,100,0),
(151400,24,-3320.1,-2000.72,92.8408,0,0,0,0,100,0),
(151400,25,-3339.1,-1994.65,92.5607,0,0,0,0,100,0),
(151400,26,-3354.66,-1989.67,93.3163,0,0,0,0,100,0),
(151400,27,-3374.56,-1983.31,92.6986,0,0,0,0,100,0),
(151400,28,-3393.45,-1977.27,92.3323,0,0,0,0,100,0),
(151400,29,-3414.45,-1970.55,92.7718,0,0,0,0,100,0),
(151400,30,-3433.01,-1964.62,92.8726,0,0,0,0,100,0),
(151400,31,-3454.24,-1957.83,92.0758,0,0,0,0,100,0),
(151400,32,-3476.91,-1950.58,92.5647,0,0,0,0,100,0),
(151400,33,-3500.46,-1943.05,92.9949,0,0,0,0,100,0),
(151400,34,-3520.12,-1936.76,93.157,0,0,0,0,100,0),
(151400,35,-3540.9,-1930.12,93.2973,0,0,0,0,100,0),
(151400,36,-3561.57,-1923.51,94.3201,0,13000,0,0,100,0),
(151400,37,-3581.36,-1931.33,93.5056,0,0,0,0,100,0),
(151400,38,-3599.98,-1938.8,92.7625,0,0,0,0,100,0),
(151400,39,-3623.47,-1948.23,94.0536,0,0,0,0,100,0),
(151400,40,-3645.02,-1956.88,91.9092,0,0,0,0,100,0),
(151400,41,-3656.14,-1971.18,91.683,0,0,0,0,100,0),
(151400,42,-3666.58,-1984.8,93.6443,0,0,0,0,100,0),
(151400,43,-3673.89,-1994.33,93.9003,0,0,0,0,100,0),
(151400,44,-3681.92,-2004.8,91.8671,0,0,0,0,100,0),
(151400,45,-3691.44,-2017.21,91.6669,0,0,0,0,100,0),
(151400,46,-3704.43,-2034.15,91.7881,0,0,0,0,100,0),
(151400,47,-3715.51,-2048.59,92.1937,0,0,0,0,100,0),
(151400,48,-3726.19,-2062.51,92.718,0,0,0,0,100,0),
(151400,49,-3737.35,-2077.05,93.3748,0,0,0,0,100,0),
(151400,50,-3747.78,-2090.66,91.988,0,0,0,0,100,0),
(151400,51,-3758.79,-2105,91.7467,0,0,0,0,100,0),
(151400,52,-3769.29,-2118.7,93.8581,0,0,0,0,100,0),
(151400,53,-3781.01,-2133.97,94.8804,0,0,0,0,100,0),
(151400,54,-3774.69,-2148.42,94.3055,0,0,0,0,100,0),
(151400,55,-3766.95,-2166.04,92.8839,0,0,0,0,100,0),
(151400,56,-3759.21,-2183.66,92.4687,0,0,0,0,100,0),
(151400,57,-3750.96,-2202.46,91.6804,0,0,0,0,100,0),
(151400,58,-3742.04,-2222.76,91.6673,0,0,0,0,100,0),
(151400,59,-3735.1,-2238.58,92.1591,0,0,0,0,100,0),
(151400,60,-3728.09,-2252.6,92.9404,0,0,0,0,100,0),
(151400,61,-3721.75,-2265.26,91.885,0,0,0,0,100,0),
(151400,62,-3714.35,-2280.01,91.7229,0,0,0,0,100,0),
(151400,63,-3709.05,-2290.57,92.4409,0,0,0,0,100,0),
(151400,65,-3700.97,-2306.97,91.7214,0,0,0,0,100,0),
(151400,66,-3693.49,-2317.25,92.2746,0,0,0,0,100,0),
(151400,67,-3684.29,-2329.89,92.5751,0,0,0,0,100,0),
(151400,68,-3676.26,-2340.93,91.6713,0,0,0,0,100,0),
(151400,69,-3667.83,-2352.59,91.6668,0,0,0,0,100,0),
(151400,70,-3657.77,-2356.66,91.6667,0,0,0,0,100,0),
(151400,71,-3648.58,-2356.08,91.757,0,0,0,0,100,0),
(151400,72,-3639.44,-2353.15,92.3895,0,0,0,0,100,0),
(151400,73,-3630.63,-2346.35,92.1355,0,0,0,0,100,0),
(151400,74,-3619.58,-2330.92,92.1996,0,0,0,0,100,0),
(151400,75,-3610.51,-2318.19,93.5333,0,0,0,0,100,0),
(151400,76,-3597.42,-2300.35,92.6799,0,0,0,0,100,0),
(151400,77,-3578.98,-2282.8,92.5617,0,0,0,0,100,0),
(151400,78,-3563.12,-2268.77,91.7997,0,0,0,0,100,0),
(151400,79,-3545.61,-2262.19,91.891,0,0,0,0,100,0),
(151400,80,-3520.45,-2253.33,92.7574,0,0,0,0,100,0),
(151400,81,-3504.12,-2243.73,92.6462,0,0,0,0,100,0),
(151400,82,-3483.87,-2233.02,93.4968,0,0,0,0,100,0),
(151400,83,-3466.74,-2226.21,91.6667,0,0,0,0,100,0),
(151400,84,-3449.51,-2219.36,92.1482,0,0,0,0,100,0),
(151400,85,-3436.5,-2214.18,93.1297,0,0,0,0,100,0),
(151400,86,-3419.36,-2207.37,92.0692,0,0,0,0,100,0),
(151400,87,-3401.99,-2200.46,93.698,0,0,0,0,100,0),
(151400,88,-3387.57,-2194.73,95.0709,0,0,0,0,100,0),
(151400,89,-3372.97,-2193.46,94.7936,0,0,0,0,100,0),
(151400,90,-3351.37,-2191.39,91.8705,0,0,0,0,100,0),
(151400,91,-3330.83,-2189.42,91.6669,0,0,0,0,100,0),
(151400,92,-3309.81,-2187.4,91.815,0,0,0,0,100,0),
(151400,93,-3293.97,-2180.13,93.5138,0,14000,0,0,100,0),
(151400,94,-3278.68,-2167.76,93.2421,0,0,0,0,100,0),
(151400,95,-3267.92,-2152.4,93.7309,0,0,0,0,100,0),
(151400,96,-3257.34,-2137.3,92.0846,0,0,0,0,100,0),
(151400,97,-3247.02,-2122.58,92.7078,0,0,0,0,100,0),
(151400,98,-3236.22,-2109.52,93.5441,0,0,0,0,100,0),
(151400,99,-3222.95,-2093.69,92.6147,0,0,0,0,100,0),
(151400,100,-3208.57,-2076.52,94.6925,0,0,0,0,100,0),
(151400,101,-3194.76,-2073.61,94.0917,0,0,0,0,100,0),
(151400,102,-3180.03,-2070.53,91.814,0,0,0,0,100,0),
(151400,103,-3164.84,-2067.36,91.8497,0,0,0,0,100,0),
(151400,104,-3154.15,-2065.12,92.807,0,11000,0,0,100,0),
(151400,105,-3144.05,-2075.1,91.9836,0,0,0,0,100,0),
(151400,106,-3125.87,-2101.69,91.6774,0,0,0,0,100,0),
(151400,107,-3105.69,-2123.68,91.8374,0,0,0,0,100,0),
(151400,108,-3082.92,-2132.46,91.7132,0,0,0,0,100,0),
(151400,109,-3064.82,-2129.17,91.6674,0,0,0,0,100,0),
(151400,110,-3046.82,-2125.78,92.8801,0,0,0,0,100,0),
(151400,111,-3033.18,-2123.21,92.8031,0,0,0,0,100,0),
(151400,112,-3020.6,-2120.84,91.6691,0,0,0,0,100,0),
(151400,113,-3004.83,-2117.88,92.6735,0,0,0,0,100,0),
(151400,114,-2983.62,-2113.88,93.5638,0,18000,0,0,100,0),
(151400,115,-2978.84,-2099.66,92.5118,0,0,0,0,100,0),
(151400,116,-2975.59,-2090.01,91.6672,0,0,0,0,100,0),
(151400,117,-2971.43,-2077.63,91.9132,0,0,0,0,100,0),
(151400,118,-2968.64,-2069.33,95.3312,0,0,0,0,100,0),
(151400,119,-2965.44,-2059.82,96.715,0,0,0,0,100,0),
(151400,120,-2962,-2049.61,95.8744,0,0,0,0,100,0),
(151400,121,-2958.74,-2039.9,96.2458,0,0,0,0,100,0),
(151400,122,-2959.56,-2030.09,97.0376,0,0,0,0,100,0),
(151400,123,-2964.79,-2022.81,96.77,0,0,0,0,100,0),
(151400,124,-2970.77,-2018.54,95.2589,0,0,0,0,100,0),
(151400,125,-2983.51,-2015.84,91.9081,0,0,0,0,100,0);

--
-- END UPDATING QUERIES
--
COMMIT;
END //
DELIMITER ;
CALL updateDb();
DROP PROCEDURE IF EXISTS `updateDb`;
