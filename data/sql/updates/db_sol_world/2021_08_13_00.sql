-- DB update 2021_08_12_03 -> 2021_08_13_00
DROP PROCEDURE IF EXISTS `updateDb`;
DELIMITER //
CREATE PROCEDURE updateDb ()
proc:BEGIN DECLARE OK VARCHAR(100) DEFAULT 'FALSE';
SELECT COUNT(*) INTO @COLEXISTS
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'version_db_sol_world' AND COLUMN_NAME = '2021_08_12_03';
IF @COLEXISTS = 0 THEN LEAVE proc; END IF;
START TRANSACTION;
ALTER TABLE version_db_sol_world CHANGE COLUMN 2021_08_12_03 2021_08_13_00 bit;
SELECT sql_rev INTO OK FROM version_db_sol_world WHERE sql_rev = '1628872284406585896'; IF OK <> 'FALSE' THEN LEAVE proc; END IF;
--
-- START UPDATING QUERIES
--

INSERT INTO `version_db_sol_world` (`sql_rev`) VALUES ('1628872284406585896');

UPDATE `creature_template` SET `unit_flags` = 0, `HealthModifier` = 4, `ArmorModifier` = 3 WHERE `entry` = 17664;

DELETE FROM `smart_scripts` WHERE `source_type` = 0 AND `entryorguid` IN (17664,17853);
DELETE FROM `smart_scripts` WHERE `source_type` = 9 AND `entryorguid` IN (1766400,1766401,1785300);
INSERT INTO `smart_scripts` (`entryorguid`, `source_type`, `id`, `link`, `event_type`, `event_phase_mask`, `event_chance`, `event_flags`, `event_param1`, `event_param2`, `event_param3`, `event_param4`, `event_param5`, `action_type`, `action_param1`, `action_param2`, `action_param3`, `action_param4`, `action_param5`, `action_param6`, `target_type`, `target_param1`, `target_param2`, `target_param3`, `target_param4`, `target_x`, `target_y`, `target_z`, `target_o`, `comment`)
VALUES
(17664,0,0,1,11,0,100,0,0,0,0,0,0,48,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Respawn - Set Active On'),
(17664,0,1,2,61,0,100,0,0,0,0,0,0,211,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - Linked - Disable Event Phase Reset'),
(17664,0,2,0,61,0,100,0,0,0,0,0,0,80,1766400,2,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - Linked - Call Timed Action List'),
(17664,0,3,4,38,0,100,0,1,1,0,0,0,22,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Data Set 1 1 - Set Phase 1'),
(17664,0,4,5,61,0,100,0,0,0,0,0,0,42,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - Linked - Set Invincibility HP Level 1'),
(17664,0,5,6,61,0,100,0,0,0,0,0,0,102,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - Linked - Set Health Regeneration Off'),
(17664,0,6,0,61,0,100,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - Linked - Say Line 0'),
(17664,0,7,0,2,1,100,1,0,5,0,0,0,80,1766401,2,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Health Between 0-5% - Call Timed Action List (Phase 1, No Repeat)'),
(17664,0,8,0,25,1,100,0,0,0,0,0,0,80,1766400,2,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Reset - Call Timed Action List (Phase 1)'),

(1766400,9,0,0,0,0,100,0,0,0,0,0,0,22,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Set Phase 0'),
(1766400,9,1,0,0,0,100,0,0,0,0,0,0,103,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Set Root Off'),
(1766400,9,2,0,0,0,100,0,0,0,0,0,0,19,768,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Remove ''UNIT_FLAG_IMMUNE_TO_PC'' & ''UNIT_FLAG_IMMUNE_TO_NPC'''),
(1766400,9,3,0,0,0,100,0,0,0,0,0,0,8,2,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Set React State ''Aggressive'''),
(1766400,9,4,0,0,0,100,0,0,0,0,0,0,42,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Reset Invincibility HP Level'),
(1766400,9,5,0,0,0,100,0,0,0,0,0,0,102,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - Linked - Set Health Regeneration On'),

(1766401,9,0,0,0,0,100,0,0,0,0,0,0,22,2,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Set Phase 2'),
(1766401,9,1,0,0,0,100,0,0,0,0,0,0,11,31336,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Cast ''Matis Captured DND'''),
(1766401,9,2,0,0,0,100,0,0,0,0,0,0,18,768,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Set ''UNIT_FLAG_IMMUNE_TO_PC'' & ''UNIT_FLAG_IMMUNE_TO_NPC'''),
(1766401,9,3,0,0,0,100,0,0,0,0,0,0,27,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Stop Combat'),
(1766401,9,4,0,0,0,100,0,0,0,0,0,0,8,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Set React State ''Passive'''),
(1766401,9,5,0,0,0,100,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Say Line 1'),
(1766401,9,6,0,0,0,100,0,0,0,0,0,0,45,1,1,0,0,0,0,19,17853,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Set Data 1 1 (Tracker of the Hand)'),
(1766401,9,7,0,0,0,100,0,0,0,0,0,0,103,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Set Root On'),
(1766401,9,8,0,0,0,100,0,1000,1000,0,0,0,90,3,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Set ''UNIT_STAND_STATE_SLEEP'''),
(1766401,9,9,0,0,0,100,0,15000,15000,0,0,0,41,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Matis the Cruel - On Script - Force Despawn'),

(17853,0,0,1,54,0,100,0,0,0,0,0,0,45,1,1,0,0,0,0,19,17664,0,0,0,0,0,0,0,'Tracker of the Hand - On Just Summoned - Set Data 1 1 (Matis the Cruel)'),
(17853,0,1,2,61,0,100,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Tracker of the Hand - Linked - Say Line 0'),
(17853,0,2,0,61,0,100,0,0,0,0,0,0,49,0,0,0,0,0,0,19,17664,0,0,0,0,0,0,0,'Tracker of the Hand - Linked - Start Attack (Matis the Cruel)'),
(17853,0,3,0,38,0,100,0,1,1,0,0,0,80,1785300,2,0,0,0,0,1,0,0,0,0,0,0,0,0,'Tracker of the Hand - On Data Set 1 1 - Call Timed Action List'),
(17853,0,4,0,1,0,100,0,30000,30000,0,0,0,41,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Tracker of the Hand - OOC - Force Despawn'),

(1785300,9,0,0,0,0,100,0,0,0,0,0,0,18,768,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Tracker of the Hand - On Script - Set ''UNIT_FLAG_IMMUNE_TO_PC'' & ''UNIT_FLAG_IMMUNE_TO_NPC'''),
(1785300,9,1,0,0,0,100,0,0,0,0,0,0,27,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Tracker of the Hand - On Script - Stop Combat'),
(1785300,9,2,0,0,0,100,0,0,0,0,0,0,8,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Tracker of the Hand - On Script - Set React State ''Passive'''),
(1785300,9,3,0,0,0,100,0,5000,5000,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Tracker of the Hand - On Script - Say Line 1'),
(1785300,9,4,0,0,0,100,0,10000,10000,0,0,0,41,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Tracker of the Hand - On Script - Force Despawn');

DELETE FROM `conditions` WHERE `SourceTypeOrReferenceId` = 17 AND `SourceEntry` = 31333;
INSERT INTO `conditions` (`SourceTypeOrReferenceId`, `SourceGroup`, `SourceEntry`, `SourceId`, `ElseGroup`, `ConditionTypeOrReference`, `ConditionTarget`, `ConditionValue1`, `ConditionValue2`, `ConditionValue3`, `NegativeCondition`, `ErrorType`, `ErrorTextId`, `Comment`)
VALUES
(17,0,31333,0,0,29,0,17664,30,0,0,0,0,'Signal Flare - Can only be used within 30y of Matis the Cruel');

DELETE FROM `waypoint_data` WHERE `id` = 633870;
INSERT INTO `waypoint_data` (`id`, `point`, `position_x`, `position_y`, `position_z`, `orientation`, `delay`, `move_type`, `action`, `action_chance`, `wpguid`)
VALUES
(633870,1,-1936.22,-10803.3,86.3323,0,0,0,0,100,0),
(633870,2,-1936.34,-10816.7,81.7697,0,0,0,0,100,0),
(633870,3,-1936.42,-10825.6,78.6164,0,0,0,0,100,0),
(633870,4,-1937.5,-10833.2,76.1483,0,0,0,0,100,0),
(633870,5,-1939.01,-10843.8,72.2672,0,0,0,0,100,0),
(633870,6,-1940.26,-10852.7,69.5764,0,0,0,0,100,0),
(633870,7,-1938.46,-10862.1,67.5083,0,0,0,0,100,0),
(633870,8,-1936.28,-10873.6,65.4276,0,0,0,0,100,0),
(633870,9,-1934.36,-10883.7,64.2909,0,0,0,0,100,0),
(633870,10,-1924.52,-10884.1,64.7624,0,0,0,0,100,0),
(633870,11,-1921.16,-10884.2,64.6192,0,0,0,0,100,0),
(633870,12,-1912.77,-10884.8,62.5705,0,0,0,0,100,0),
(633870,13,-1905.14,-10885.2,64.5696,0,0,0,0,100,0),
(633870,14,-1899.85,-10885.5,66.1877,0,0,0,0,100,0),
(633870,15,-1894.95,-10885.4,66.7294,0,0,0,0,100,0),
(633870,16,-1891.25,-10885.3,66.968,0,9000,0,0,100,0),
(633870,17,-1881.7,-10886.8,66.843,0.664463,6000,0,0,100,0),
(633870,18,-1889.14,-10884,66.9757,0,0,0,0,100,0),
(633870,19,-1894.3,-10882.1,66.8888,0,0,0,0,100,0),
(633870,20,-1900.53,-10879.8,66.0236,0,0,0,0,100,0),
(633870,21,-1907.6,-10877.2,63.8809,0,0,0,0,100,0),
(633870,22,-1913.61,-10883.1,62.7537,0,0,0,0,100,0),
(633870,23,-1917.86,-10887.2,63.9052,0,0,0,0,100,0),
(633870,24,-1921.44,-10890.7,64.6974,0,0,0,0,100,0),
(633870,25,-1925.62,-10894.8,64.0321,0,0,0,0,100,0),
(633870,26,-1929.88,-10899,63.1309,0,0,0,0,100,0),
(633870,27,-1929.1,-10908.2,62.651,0,0,0,0,100,0),
(633870,28,-1928.44,-10915.9,62.2858,0,0,0,0,100,0),
(633870,29,-1923.35,-10922.7,61.8927,0,0,0,0,100,0),
(633870,30,-1916.11,-10932.5,61.4944,0,0,0,0,100,0),
(633870,31,-1908.86,-10942.2,61.4528,0,0,0,0,100,0),
(633870,32,-1903.14,-10949.9,61.3822,0,0,0,0,100,0),
(633870,33,-1897.43,-10959,61.324,0,0,0,0,100,0),
(633870,34,-1888.87,-10972.6,60.9623,0,0,0,0,100,0),
(633870,35,-1881.35,-10984.6,60.8757,0,0,0,0,100,0),
(633870,36,-1882.3,-10995.6,60.553,0,0,0,0,100,0),
(633870,37,-1883.33,-11007.5,60.1874,0,0,0,0,100,0),
(633870,38,-1884.31,-11018.9,60.1304,0,0,0,0,100,0),
(633870,39,-1885.17,-11029.9,59.6605,0,0,0,0,100,0),
(633870,40,-1885.95,-11039.9,59.3696,0,0,0,0,100,0),
(633870,41,-1886.83,-11051.3,59.4839,4.16893,5000,0,0,100,0),
(633870,42,-1880.18,-11059.1,59.675,0,0,0,0,100,0),
(633870,43,-1871.71,-11069.1,60.2228,0,0,0,0,100,0),
(633870,44,-1862.6,-11079.8,61.1763,0,0,0,0,100,0),
(633870,45,-1854.41,-11083.2,61.6851,0,0,0,0,100,0),
(633870,46,-1842.66,-11088.1,62.4512,0,0,0,0,100,0),
(633870,47,-1831.74,-11092.6,63.6177,0,0,0,0,100,0),
(633870,48,-1826.25,-11100.4,63.97,0,0,0,0,100,0),
(633870,49,-1820.16,-11109.1,64.2781,0,0,0,0,100,0),
(633870,50,-1814.87,-11116.7,64.3087,0,0,0,0,100,0),
(633870,51,-1810.02,-11123.6,64.2915,0,0,0,0,100,0),
(633870,52,-1806.69,-11130.2,64.4113,0,0,0,0,100,0),
(633870,53,-1801.34,-11140.7,64.1967,0,0,0,0,100,0),
(633870,54,-1796.2,-11150.8,64.4617,0,0,0,0,100,0),
(633870,55,-1790.78,-11161.4,64.3324,0,0,0,0,100,0),
(633870,56,-1787.46,-11167.6,64.282,0,0,0,0,100,0),
(633870,57,-1783.31,-11175.3,64.0899,0,0,0,0,100,0),
(633870,58,-1779.77,-11181.8,64.2464,0,0,0,0,100,0),
(633870,59,-1775.8,-11189.2,63.9911,0,0,0,0,100,0),
(633870,60,-1776.56,-11197.3,63.6727,0,0,0,0,100,0),
(633870,61,-1777.38,-11206.2,63.3707,0,0,0,0,100,0),
(633870,62,-1778.26,-11215.6,62.8112,0,0,0,0,100,0),
(633870,63,-1779.32,-11226.9,61.8887,0,0,0,0,100,0),
(633870,64,-1780.47,-11235,61.1915,0,0,0,0,100,0),
(633870,65,-1782.43,-11248.8,60.151,0,0,0,0,100,0),
(633870,66,-1784.68,-11264.7,59.0894,0,0,0,0,100,0),
(633870,67,-1782.95,-11272.9,58.6019,0,0,0,0,100,0),
(633870,68,-1780.96,-11282.4,58.2143,0,0,0,0,100,0),
(633870,69,-1778.98,-11291.8,57.7191,0,0,0,0,100,0),
(633870,70,-1776.88,-11301.8,57.3209,0,0,0,0,100,0),
(633870,71,-1772.57,-11309.8,56.9779,0,0,0,0,100,0),
(633870,72,-1767.53,-11319.2,56.6124,0,0,0,0,100,0),
(633870,73,-1763.04,-11327.5,56.3828,0,0,0,0,100,0),
(633870,74,-1759.69,-11334.7,56.0165,0,0,0,0,100,0),
(633870,75,-1755.6,-11343.5,55.6284,0,0,0,0,100,0),
(633870,76,-1751.65,-11351.9,55.0436,0,0,0,0,100,0),
(633870,77,-1747.19,-11361.5,54.6775,0,0,0,0,100,0),
(633870,78,-1745.34,-11368.4,54.288,0,0,0,0,100,0),
(633870,79,-1743.72,-11374.5,53.7724,0,0,0,0,100,0),
(633870,80,-1741.52,-11382.7,52.2249,0,0,0,0,100,0),
(633870,81,-1738.96,-11392.3,50.9314,0,0,0,0,100,0),
(633870,82,-1735.95,-11403.6,49.3072,0,5000,0,0,100,0),
(633870,83,-1738.47,-11406,48.9322,0,9000,0,0,100,0),
(633870,84,-1737.84,-11400.4,49.7636,0,0,0,0,100,0),
(633870,85,-1737.17,-11394.6,50.7059,0,0,0,0,100,0),
(633870,86,-1738.95,-11387.8,51.3895,0,0,0,0,100,0),
(633870,87,-1741.03,-11379.9,52.6329,0,0,0,0,100,0),
(633870,88,-1742.93,-11372.7,53.8481,0,0,0,0,100,0),
(633870,89,-1744.32,-11367.4,54.3309,0,0,0,0,100,0),
(633870,90,-1748.13,-11359.1,54.6659,0,0,0,0,100,0),
(633870,91,-1752.72,-11349.2,55.2232,0,0,0,0,100,0),
(633870,92,-1757.14,-11339.6,55.9275,0,0,0,0,100,0),
(633870,93,-1761.26,-11332.1,56.1361,0,0,0,0,100,0),
(633870,94,-1764.99,-11325.4,56.3886,0,0,0,0,100,0),
(633870,95,-1769.06,-11318.1,56.6641,0,0,0,0,100,0),
(633870,96,-1772.24,-11312.3,56.9459,0,0,0,0,100,0),
(633870,97,-1774.85,-11305.8,57.1035,0,0,0,0,100,0),
(633870,98,-1778.73,-11296.2,57.4295,0,0,0,0,100,0),
(633870,99,-1783.1,-11285.3,58.1494,0,0,0,0,100,0),
(633870,100,-1783.77,-11278.2,58.2849,0,0,0,0,100,0),
(633870,101,-1784.83,-11266.9,58.9131,0,0,0,0,100,0),
(633870,102,-1786.24,-11251.9,59.9644,0,0,0,0,100,0),
(633870,103,-1784.13,-11244.3,60.4077,0,0,0,0,100,0),
(633870,104,-1781.51,-11234.8,61.1845,0,0,0,0,100,0),
(633870,105,-1778.22,-11222.9,62.3887,0,0,0,0,100,0),
(633870,106,-1778.38,-11214.2,62.8904,0,0,0,0,100,0),
(633870,107,-1778.6,-11202.1,63.5376,0,0,0,0,100,0),
(633870,108,-1778.8,-11190.9,63.9911,0,0,0,0,100,0),
(633870,109,-1781.52,-11184.5,64.2092,0,0,0,0,100,0),
(633870,110,-1784.65,-11177,64.0886,0,0,0,0,100,0),
(633870,111,-1787.37,-11170.6,64.1454,0,0,0,0,100,0),
(633870,112,-1790.95,-11162.1,64.2426,0,0,0,0,100,0),
(633870,113,-1794.9,-11152.7,64.5824,0,0,0,0,100,0),
(633870,114,-1798,-11146,64.3548,0,0,0,0,100,0),
(633870,115,-1802.38,-11136.6,64.2423,0,0,0,0,100,0),
(633870,116,-1805.74,-11129.4,64.512,0,0,0,0,100,0),
(633870,117,-1812.15,-11115.6,64.5415,0,0,0,0,100,0),
(633870,118,-1817.18,-11110.2,64.3602,0,0,0,0,100,0),
(633870,119,-1822.38,-11104.7,64.1765,0,0,0,0,100,0),
(633870,120,-1828.53,-11098.2,63.8513,0,0,0,0,100,0),
(633870,121,-1834.33,-11092,63.4263,0,0,0,0,100,0),
(633870,122,-1843.14,-11086.7,62.3624,0,0,0,0,100,0),
(633870,123,-1851.74,-11081.6,61.7838,0,0,0,0,100,0),
(633870,124,-1859.51,-11076.9,61.3013,0,0,0,0,100,0),
(633870,125,-1865.73,-11072.2,60.776,0,0,0,0,100,0),
(633870,126,-1874.92,-11065.2,59.9392,0,0,0,0,100,0),
(633870,127,-1884.71,-11057.7,59.6089,0,0,0,0,100,0),
(633870,128,-1883.8,-11049.9,59.5486,0,0,0,0,100,0),
(633870,129,-1882.28,-11037,59.6855,0,0,0,0,100,0),
(633870,130,-1880.73,-11023.8,60.1304,0,0,0,0,100,0),
(633870,131,-1881,-11015.6,60.114,0,0,0,0,100,0),
(633870,132,-1881.51,-11000.2,60.4616,0,0,0,0,100,0),
(633870,133,-1881.92,-10987.8,60.7507,0,0,0,0,100,0),
(633870,134,-1886.22,-10979.4,60.7932,0,0,0,0,100,0),
(633870,135,-1890.78,-10970.5,61.0504,0,0,0,0,100,0),
(633870,136,-1895.3,-10961.6,61.2911,0,0,0,0,100,0),
(633870,137,-1899.09,-10954.2,61.3946,0,5000,0,0,100,0),
(633870,138,-1904.14,-10947.5,61.424,0,0,0,0,100,0),
(633870,139,-1910.67,-10938.8,61.4511,0,0,0,0,100,0),
(633870,140,-1917.23,-10930.1,61.6608,0,0,0,0,100,0),
(633870,141,-1921.43,-10922.2,61.8706,0,0,0,0,100,0),
(633870,142,-1926.2,-10913.1,62.3833,0,0,0,0,100,0),
(633870,143,-1929.92,-10906.1,62.7062,0,0,0,0,100,0),
(633870,144,-1936.52,-10893.6,63.291,0,0,0,0,100,0),
(633870,145,-1937.15,-10885.1,64.0114,0,0,0,0,100,0),
(633870,146,-1937.94,-10874.4,65.3414,0,0,0,0,100,0),
(633870,147,-1938.69,-10864.2,67.2014,0,0,0,0,100,0),
(633870,148,-1939.96,-10857.4,68.4594,0,0,0,0,100,0),
(633870,149,-1941.42,-10849.6,70.3264,0,0,0,0,100,0),
(633870,150,-1934.65,-10841.3,73.5764,0,0,0,0,100,0),
(633870,151,-1935.18,-10831.4,76.5323,0,0,0,0,100,0),
(633870,152,-1935.68,-10822,79.7548,0,0,0,0,100,0),
(633870,153,-1935.98,-10811.7,83.4404,0,0,0,0,100,0),
(633870,154,-1936.22,-10803.3,86.3798,0,12000,0,0,100,0);

--
-- END UPDATING QUERIES
--
COMMIT;
END //
DELIMITER ;
CALL updateDb();
DROP PROCEDURE IF EXISTS `updateDb`;
