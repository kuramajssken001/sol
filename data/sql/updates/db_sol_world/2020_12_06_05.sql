-- DB update 2020_12_06_04 -> 2020_12_06_05
DROP PROCEDURE IF EXISTS `updateDb`;
DELIMITER //
CREATE PROCEDURE updateDb ()
proc:BEGIN DECLARE OK VARCHAR(100) DEFAULT 'FALSE';
SELECT COUNT(*) INTO @COLEXISTS
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'version_db_sol_world' AND COLUMN_NAME = '2020_12_06_04';
IF @COLEXISTS = 0 THEN LEAVE proc; END IF;
START TRANSACTION;
ALTER TABLE version_db_sol_world CHANGE COLUMN 2020_12_06_04 2020_12_06_05 bit;
SELECT sql_rev INTO OK FROM version_db_sol_world WHERE sql_rev = '1607279138124696435'; IF OK <> 'FALSE' THEN LEAVE proc; END IF;
--
-- START UPDATING QUERIES
--

INSERT INTO `version_db_sol_world` (`sql_rev`) VALUES ('1607279138124696435');

-- Stormwind
UPDATE `creature_formations` SET `angle` = 270 WHERE `leaderGUID` IN (208136,208149,208162,208123,208110) AND `memberGUID` IN (208116,208129,208142,208155,208168);

-- Thunder Bluff
UPDATE `creature_formations` SET `angle` = 270 WHERE `leaderGUID` IN (208357,208396,208370,208344,208331) AND `memberGUID` IN (208336,208349,208362,208375,208401);

-- Ironforge
UPDATE `creature_formations` SET `angle` = 0 WHERE `leaderGUID` IN (208032,208071,208058,208084,208045) AND `memberGUID` IN (208033,208046,208059,208072,208085);

-- Silvermoon
UPDATE `creature_formations` SET `angle` = 270 WHERE `leaderGUID` IN (208280,208319,208306,208267,208254) AND `memberGUID` IN (208255,208268,208281,208307,208320);

-- Exodar
UPDATE `creature_formations` SET `angle` = 270 WHERE `leaderGUID` IN (207967,208019,207993,207980,207954) AND `memberGUID` IN (207960,207973,207986,207999,208025);

-- Orgrimmar
UPDATE `creature_formations` SET `angle` = 270 WHERE `leaderGUID` IN (208247,208236,208225,208192,208214) AND `memberGUID` IN (208193,208215,208226,208237,208248);

-- Darnassus
UPDATE `creature_formations` SET `angle` = 270 WHERE `leaderGUID` IN (207920,207909,207887,207931,207898) AND `memberGUID` IN (207892,207903,207914,207925,207936);

--
-- END UPDATING QUERIES
--
COMMIT;
END //
DELIMITER ;
CALL updateDb();
DROP PROCEDURE IF EXISTS `updateDb`;
