-- DB update 2022_04_13_04 -> 2022_04_14_00
DROP PROCEDURE IF EXISTS `updateDb`;
DELIMITER //
CREATE PROCEDURE updateDb ()
proc:BEGIN DECLARE OK VARCHAR(100) DEFAULT 'FALSE';
SELECT COUNT(*) INTO @COLEXISTS
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'version_db_sol_world' AND COLUMN_NAME = '2022_04_13_04';
IF @COLEXISTS = 0 THEN LEAVE proc; END IF;
START TRANSACTION;
ALTER TABLE version_db_sol_world CHANGE COLUMN 2022_04_13_04 2022_04_14_00 bit;
SELECT sql_rev INTO OK FROM version_db_sol_world WHERE sql_rev = '1649932805713215324'; IF OK <> 'FALSE' THEN LEAVE proc; END IF;
--
-- START UPDATING QUERIES
--

INSERT INTO `version_db_sol_world` (`sql_rev`) VALUES ('1649932805713215324');

UPDATE `creature` SET `position_x` = -29.4619, `position_y` = -2615.94, `position_z` = 97.1569 WHERE `guid` = 13166;
UPDATE `creature` SET `position_x` = -31.4226, `position_y` = -2615.42, `position_z` = 97.0909, `MovementType` = 0 WHERE `guid` = 13578;
UPDATE `creature` SET `modelid` = 0 WHERE `id` = 3501; -- Horde Guard: Use random model ID

UPDATE `creature_addon` SET `bytes2` = 1 WHERE `guid` = 13166;
UPDATE `creature_addon` SET `path_id` = 0 WHERE `guid` = 13578;

DELETE FROM `creature_text` WHERE `CreatureId` IN (14857,14893);
INSERT INTO `creature_text` (`CreatureID`, `GroupID`, `ID`, `Text`, `Type`, `Language`, `Probability`, `Emote`, `Duration`, `Sound`, `BroadcastTextId`, `TextRange`, `comment`)
VALUES
(14857,0,0,'Hmmm... Where is my fishing hook? Oh, there it is.',12,1,100,0,0,0,10249,0,'Erk'),
(14857,1,0,'Let''s see if the fish are biting.',12,1,100,0,0,0,10250,0,'Erk'),
(14857,2,0,'Hmmm... I think I need better bait. I''ll check my father''s wagon.',12,1,100,0,0,0,10195,0,'Erk'),
(14857,3,0,'Quillboar scraps! These should do the trick. Fish love Quillboar.',12,1,100,0,0,0,10196,0,'Erk'),
(14857,4,0,'Let''s give this a try...',12,1,100,0,0,0,10197,0,'Erk'),
(14857,5,0,'Caught one! I''ll see if any of the guards are hungry. Come on Fang!',12,1,100,0,0,0,10205,0,'Erk'),
(14857,6,0,'I caught a fish if you are hungry...',12,1,100,0,0,0,10198,0,'Erk'),
(14857,7,0,'Zug zug! Happy to help!',12,1,100,0,0,0,10206,0,'Erk'),

(14893,0,0,'A nice catch it is at that! You bring honor to the Horde boy, We thank you!',12,1,100,0,0,0,10223,0,'Guard Kurall');

DELETE FROM `creature_formations` WHERE `leaderGUID` = 13166;
INSERT INTO `creature_formations` (`leaderGUID`, `memberGUID`, `dist`, `angle`, `groupAI`)
VALUES
(13166,13166,0,0,0),
(13166,13578,3,0,0);

UPDATE `creature_template` SET `AIName` = 'SmartAI' WHERE `entry` = 14857;
DELETE FROM `smart_scripts` WHERE `source_type` = 0 AND `entryorguid` = 14857;
DELETE FROM `smart_scripts` WHERE `source_type` = 9 AND `entryorguid` IN (1485700,1485701,1485702,1485703,1485704);
INSERT INTO `smart_scripts` (`entryorguid`, `source_type`, `id`, `link`, `event_type`, `event_phase_mask`, `event_chance`, `event_flags`, `event_param1`, `event_param2`, `event_param3`, `event_param4`, `event_param5`, `action_type`, `action_param1`, `action_param2`, `action_param3`, `action_param4`, `action_param5`, `action_param6`, `target_type`, `target_param1`, `target_param2`, `target_param3`, `target_param4`, `target_x`, `target_y`, `target_z`, `target_o`, `comment`)
VALUES
(14857,0,0,0,11,0,100,0,0,0,0,0,0,48,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On Respawn - Set Active On'),
(14857,0,1,0,34,0,100,0,2,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On WP 2 Reached - Say Line 0'),
(14857,0,2,0,34,0,100,0,2,7,0,0,0,80,1485700,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On WP 8 Reached - Call Timed Action List'),
(14857,0,3,0,34,0,100,0,2,20,0,0,0,80,1485701,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On WP 21 Reached - Call Timed Action List'),
(14857,0,4,0,34,0,100,0,2,31,0,0,0,80,1485702,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On WP 32 Reached - Call Timed Action List'),
(14857,0,5,0,34,0,100,0,2,47,0,0,0,80,1485703,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On WP 48 Reached - Call Timed Action List'),
(14857,0,6,0,34,0,100,0,2,69,0,0,0,80,1485704,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On WP 70 Reached - Call Timed Action List'),

(1485700,9,0,0,0,0,100,0,3000,3000,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On Script - Say Line 1'),
(1485700,9,1,0,0,0,100,0,180000,360000,0,0,0,1,2,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On Script - Say Line 2'),
(1485700,9,2,0,0,0,100,0,0,0,0,0,0,239,5000,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On Script - Resume WP Path After 5 Seconds'),

(1485701,9,0,0,0,0,100,0,10000,10000,0,0,0,1,3,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On Script - Say Line 3'),

(1485702,9,0,0,0,0,100,0,3000,3000,0,0,0,1,4,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On Script - Say Line 4'),
(1485702,9,1,0,0,0,100,0,180000,360000,0,0,0,1,5,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On Script - Say Line 5'),
(1485702,9,2,0,0,0,100,0,0,0,0,0,0,239,5000,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On Script - Resume WP Path After 5 Seconds'),

(1485703,9,1,0,0,0,100,0,3000,3000,0,0,0,1,6,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On Script - Say Line 6'),
(1485703,9,2,0,0,0,100,0,5000,5000,0,0,0,1,0,0,0,0,0,0,19,14893,30,0,0,0,0,0,0,'Erk - On Script - Say Line 0 (Guard Kurall)'),
(1485703,9,3,0,0,0,100,0,1000,1000,0,0,0,5,21,0,0,0,0,0,19,14893,30,0,0,0,0,0,0,'Erk - On Script - Play Emote ''ONESHOT_APPLAUD'' (Guard Kurall)'),
(1485703,9,4,0,0,0,100,0,5000,5000,0,0,0,5,7,0,0,0,0,0,19,14893,30,0,0,0,0,0,0,'Erk - On Script - Play Emote ''ONESHOT_EAT'' (Guard Kurall)'),
(1485703,9,5,0,0,0,100,0,0,0,0,0,0,5,7,0,0,0,0,0,19,3501,30,0,0,0,0,0,0,'Erk - On Script - Play Emote ''ONESHOT_EAT'' (Horde Guard)'),
(1485703,9,6,0,0,0,100,0,7000,7000,0,0,0,1,7,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On Script - Say Line 7'),

(1485704,9,0,0,0,0,100,0,180000,360000,0,0,0,239,5000,0,0,0,0,0,1,0,0,0,0,0,0,0,0,'Erk - On Script - Resume WP Path After 5 Seconds');

-- Horde Guard: Add delay to one of the waypoints
UPDATE `waypoint_data` SET `delay` = 60000 WHERE `id` = 194380 AND `point` = 30;

DELETE FROM `waypoint_data` WHERE `id` IN (131660,135780);
INSERT INTO `waypoint_data` (`id`, `point`, `position_x`, `position_y`, `position_z`, `orientation`, `delay`, `move_type`, `pathfinding`, `action`, `action_chance`, `wpguid`)
VALUES
(131660,1,-29.4619,-2615.94,97.1569,0,0,0,0,0,100,0),
(131660,2,-25.8713,-2613.07,97.2377,0,10000,0,0,0,100,0),
(131660,3,-19.1492,-2619.64,97.2062,0,0,0,0,0,100,0),
(131660,4,-11.7613,-2621.95,95.72,0,0,0,0,0,100,0),
(131660,5,-9.08595,-2621.67,94.9584,0,0,0,0,0,100,0),
(131660,6,-3.63306,-2621.64,92.1312,0,0,0,0,0,100,0),
(131660,7,-0.245072,-2621.65,91.2962,0,0,0,0,0,100,0),
(131660,8,3.79072,-2621.66,89.8122,0,400000,0,0,0,100,0),
(131660,9,2.11435,-2624.18,90.302,0,0,0,0,0,100,0),
(131660,10,-0.1508,-2627.58,91.0556,0,0,0,0,0,100,0),
(131660,11,-2.78568,-2631.54,91.5307,0,0,0,0,0,100,0),
(131660,12,-4.09707,-2636.68,91.9798,0,0,0,0,0,100,0),
(131660,13,-7.14824,-2638.56,93.9695,0,0,0,0,0,100,0),
(131660,14,-9.7202,-2640.14,95.6607,0,0,0,0,0,100,0),
(131660,15,-12.5397,-2641.78,95.8304,0,0,0,0,0,100,0),
(131660,16,-17.5796,-2644.71,95.8306,0,0,0,0,0,100,0),
(131660,17,-21.9055,-2647.23,95.8334,0,0,0,0,0,100,0),
(131660,18,-29.9285,-2641.6,96.0804,0,0,0,0,0,100,0),
(131660,19,-33.6012,-2638.69,96.4458,0,0,0,0,0,100,0),
(131660,20,-33.7544,-2634.78,96.275,0,0,0,0,0,100,0),
(131660,21,-29.1425,-2632.01,95.9483,5.94497,15000,0,0,0,100,0),
(131660,22,-32.0825,-2632.89,96.0727,0,0,0,0,0,100,0),
(131660,23,-32.9846,-2638.7,96.3846,0,0,0,0,0,100,0),
(131660,24,-31.5213,-2644.06,96.1429,0,0,0,0,0,100,0),
(131660,25,-24.4697,-2646.37,95.8326,0,0,0,0,0,100,0),
(131660,26,-18.6414,-2646.82,95.8326,0,0,0,0,0,100,0),
(131660,27,-13.5827,-2643.7,95.8281,0,0,0,0,0,100,0),
(131660,28,-9.77005,-2641.35,95.5894,0,0,0,0,0,100,0),
(131660,29,-8.47826,-2640.57,95.2277,0,0,0,0,0,100,0),
(131660,30,-3.89023,-2637.86,92.0007,0,0,0,0,0,100,0),
(131660,31,0.89984,-2634.96,91.1477,0,0,0,0,0,100,0),
(131660,32,4.77875,-2632.61,89.838,0,400000,0,0,0,100,0),
(131660,33,4.56817,-2635.55,90.4474,0,0,1,0,0,100,0),
(131660,34,10.7483,-2640.52,90.3865,0,0,1,0,0,100,0),
(131660,35,16.7341,-2644.15,91.0351,0,0,1,0,0,100,0),
(131660,36,20.2542,-2646.28,91.5714,0,0,1,0,0,100,0),
(131660,37,27.7305,-2650.82,91.6666,0,0,1,0,0,100,0),
(131660,38,34.7806,-2655.09,91.9127,0,0,1,0,0,100,0),
(131660,39,40.2516,-2660,92.0184,0,0,1,0,0,100,0),
(131660,40,47.1971,-2666.23,91.7003,0,0,1,0,0,100,0),
(131660,41,53.317,-2671.72,91.6669,0,0,1,0,0,100,0),
(131660,42,56.1152,-2676.44,91.8307,0,0,1,0,0,100,0),
(131660,43,59.4453,-2682.06,92.6253,0,0,1,0,0,100,0),
(131660,44,61.6115,-2685.71,92.8854,0,0,1,0,0,100,0),
(131660,45,63.5888,-2689.05,92.9446,0,0,1,0,0,100,0),
(131660,46,61.9132,-2693.65,92.5471,0,0,1,0,0,100,0),
(131660,47,60.2265,-2698.29,92.0961,0,0,1,0,0,100,0),
(131660,48,55.0459,-2698.41,91.9447,2.04254,24000,1,0,0,100,0),
(131660,49,50.6632,-2700.36,91.78,0,0,0,0,0,100,0),
(131660,50,45.8985,-2702.47,91.7002,0,0,0,0,0,100,0),
(131660,51,38.5667,-2702.87,91.6708,0,0,0,0,0,100,0),
(131660,52,31.0409,-2703.29,91.6676,0,0,0,0,0,100,0),
(131660,53,23.5055,-2699.47,91.7346,0,0,0,0,0,100,0),
(131660,54,19.0905,-2693.45,91.9737,0,0,0,0,0,100,0),
(131660,55,14.7458,-2687.52,91.9562,0,0,0,0,0,100,0),
(131660,56,10.4826,-2681.7,91.7507,0,0,0,0,0,100,0),
(131660,57,5.02738,-2675.33,91.6676,0,0,0,0,0,100,0),
(131660,58,-0.678281,-2668.66,91.9212,0,0,0,0,0,100,0),
(131660,59,-3.76023,-2665.21,92.99,0,0,0,0,0,100,0),
(131660,60,-6.63082,-2661.99,94.4085,0,0,0,0,0,100,0),
(131660,61,-8.81453,-2659.54,95.5593,0,0,0,0,0,100,0),
(131660,62,-10.102,-2655.9,95.7918,0,0,0,0,0,100,0),
(131660,63,-12.4386,-2649.31,95.8064,0,0,0,0,0,100,0),
(131660,64,-14.4874,-2643.52,95.8315,0,0,0,0,0,100,0),
(131660,65,-15.1416,-2637.72,95.7652,0,0,0,0,0,100,0),
(131660,66,-15.8483,-2631.45,95.7369,0,0,0,0,0,100,0),
(131660,67,-16.6059,-2624.73,96.2192,0,0,0,0,0,100,0),
(131660,68,-17.0888,-2620.45,96.3303,0,0,0,0,0,100,0),
(131660,69,-19.1079,-2619.6,97.1972,0,0,0,0,0,100,0),
(131660,70,-29.4619,-2615.94,97.1569,0,400000,0,0,0,100,0);

--
-- END UPDATING QUERIES
--
COMMIT;
END //
DELIMITER ;
CALL updateDb();
DROP PROCEDURE IF EXISTS `updateDb`;
