-- DB update 2020_05_25_00 -> 2020_05_25_01
DROP PROCEDURE IF EXISTS `updateDb`;
DELIMITER //
CREATE PROCEDURE updateDb ()
proc:BEGIN DECLARE OK VARCHAR(100) DEFAULT 'FALSE';
SELECT COUNT(*) INTO @COLEXISTS
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'version_db_sol_world' AND COLUMN_NAME = '2020_05_25_00';
IF @COLEXISTS = 0 THEN LEAVE proc; END IF;
START TRANSACTION;
ALTER TABLE version_db_sol_world CHANGE COLUMN 2020_05_25_00 2020_05_25_01 bit;
SELECT sql_rev INTO OK FROM version_db_sol_world WHERE sql_rev = '1590409315182043459'; IF OK <> 'FALSE' THEN LEAVE proc; END IF;
--
-- START UPDATING QUERIES
--

INSERT INTO `version_db_sol_world` (`sql_rev`) VALUES ('1590409315182043459');

-- Revantusk Watcher: Disable and remove waypoints as the NPC is part of a formation
UPDATE `creature` SET `MovementType` = 0 WHERE `guid` = 92904;
UPDATE `creature_addon` SET `path_id` = 0 WHERE `guid` = 92904;
DELETE FROM `waypoint_data` WHERE `id` = 929040;

-- Revantusk Watcher: Adjust waypoints for the formation leader
DELETE FROM `waypoint_data` WHERE `id` = 929030;
INSERT INTO `waypoint_data` (`id`, `point`, `position_x`, `position_y`, `position_z`, `orientation`, `delay`, `move_type`, `action`, `action_chance`, `wpguid`)
VALUES
(929030,1,-589.121,-4560.01,9.16149,0,0,0,0,100,0),
(929030,2,-586.805,-4558.02,9.16149,0,0,0,0,100,0),
(929030,3,-582.109,-4557.42,9.41823,0,0,0,0,100,0),
(929030,4,-570.499,-4568.34,9.25721,0,0,0,0,100,0),
(929030,5,-564.857,-4568.31,9.43048,0,0,0,0,100,0),
(929030,6,-558.731,-4558.74,10.0479,0,0,0,0,100,0),
(929030,7,-551.915,-4546.66,10.2016,0,0,0,0,100,0),
(929030,8,-530.586,-4534.89,10.8851,0,0,0,0,100,0),
(929030,9,-528.094,-4540.74,10.6841,0,0,0,0,100,0),
(929030,10,-548.425,-4552.03,10.3369,0,0,0,0,100,0),
(929030,11,-558.273,-4566.22,9.79809,0,0,0,0,100,0),
(929030,12,-558.353,-4572.36,9.73495,0,0,0,0,100,0),
(929030,13,-552.005,-4585.1,9.83017,0,0,0,0,100,0),
(929030,14,-553.542,-4597.6,9.48219,0,0,0,0,100,0),
(929030,15,-559.108,-4612.72,9.86417,0,0,0,0,100,0),
(929030,16,-570.518,-4617.98,9.60628,0,0,0,0,100,0),
(929030,17,-587.542,-4618.49,9.45676,0,0,0,0,100,0),
(929030,18,-596.183,-4629.22,9.79685,0,0,0,0,100,0),
(929030,19,-601.012,-4628.75,9.4112,0,0,0,0,100,0),
(929030,20,-592.422,-4616.15,9.35991,0,0,0,0,100,0),
(929030,21,-588.697,-4613.22,9.55808,0,0,0,0,100,0),
(929030,22,-567.405,-4614.91,9.72995,0,0,0,0,100,0),
(929030,23,-557.497,-4586.75,9.7304,0,0,0,0,100,0),
(929030,24,-565.143,-4573.83,9.52695,0,0,0,0,100,0),
(929030,25,-587.959,-4565.16,9.16149,0,0,0,0,100,0);

--
-- END UPDATING QUERIES
--
COMMIT;
END //
DELIMITER ;
CALL updateDb();
DROP PROCEDURE IF EXISTS `updateDb`;
